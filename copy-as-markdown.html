<style type="text/css" media="screen">
#container {
  width: 240px;
  font-family: sans-serif;
}

ul.menu {
  font-size: 16px;
  list-style: none;
  padding: 0 0.5em;
}

ul.menu > li {
  border: 1px solid black;
  padding: 5px;
  border-radius: 5px;
  margin-top: 3px;
  margin-bottom: 3px;
  cursor: pointer;
}

ul.menu > li.hover {
  background-color: #FCC;
}

h1 {
  font-size: 18px;
}

#result input[type="text"] {
  width: 100%;
}

</style>

<div id="container">
  <div id="result">
    <input type="text" id="result-markdown" readonly="readonly" />
  </div>
  <div id="current-tab">
    <h1>Current Tab</h1>
    <ul class="menu">
      <li id="current-tab-link"><code>[title](url)</code></li>
      <li id="current-tab-link-with-identifier"><code>[title][<em>identifier</em>]</code></li>
    </ul>
  </div>
</div>

<script type="text/javascript">
(function() {
  var CopyAsMarkdown = new (function() {
    var resultContainer = document.getElementById("result-markdown");
    resultContainer.addEventListener("click", function() {
      resultContainer.select();
    });

    var setMarkdownResult = function(text) {
      resultContainer.value = text;
    };

    var copyMarkdownCodeToClipboard = function() {
      resultContainer.select();
      document.execCommand('Copy');
    }

    this.copyTabAsLink = function(tab, options) {
      if (options === undefined) {
        options = { use_identifier: false };
      }

      var result = "";
      if (options.use_identifier === true) {
        result = "[" + tab.title + "][identifier]\n\n[identifier]: " + tab.url;
      } else {
        result = "[" + tab.title + "](" + tab.url + ")";
      }

      setMarkdownResult(result);
      copyMarkdownCodeToClipboard();
    }

    this.copySelectedTabAsLink = function(options) {
      chrome.tabs.getSelected(null, function(tab) {
        CopyAsMarkdown.copyTabAsLink(tab, options);
      });
    }
  })();

  document.getElementById("current-tab-link").addEventListener("click", function() {
    CopyAsMarkdown.copySelectedTabAsLink({use_identifier: false});
  });

  document.getElementById("current-tab-link-with-identifier").addEventListener("click", function() {
    CopyAsMarkdown.copySelectedTabAsLink({use_identifier: true});
  })
})();
</script>